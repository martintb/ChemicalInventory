{% extends "base.html" %}
{% block title %}View Campaign - {{ campaign_id }}{% endblock %}
{% block head %}
  <!-- Include Tabulator CSS -->
  <link href="https://unpkg.com/tabulator-tables@5.4.4/dist/css/tabulator.min.css" rel="stylesheet">
{% endblock %}
{% block content %}
<h1>Campaign: {{ campaign_id }}</h1>
<div id="campaign-table" style="margin-bottom:20px;"></div>
<div class="mt-3">
  <a href="{{ url_for('download_campaign', campaign_id=campaign_id) }}" class="btn btn-success">Download Campaign CSV</a>
  <a href="{{ url_for('campaign', campaign_id=campaign_id) }}" class="btn btn-warning">Resume Campaign</a>
</div>
{% endblock %}
{% block scripts %}
  <!-- Include Tabulator JS -->
  <script src="https://unpkg.com/tabulator-tables@5.4.4/dist/js/tabulator.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function(){
        // Define the full set of columns (scan metadata and reference data)
        var columns = [
            {title:"Barcode", field:"barcode", headerFilter:"input"},
            {title:"Scan Time", field:"timestamp", sorter:"datetime", headerFilter:"input"},
            {title:"Building", field:"scan_building", headerFilter:"input"},
            {title:"Room", field:"scan_room", headerFilter:"input"},
            {title:"Location", field:"scan_location", headerFilter:"input"},
            {title:"Category", field:"category", headerFilter:"input"},
            {title:"Status", field:"Status - Container", headerFilter:"input"},
            {title:"Time Sensitive", field:"Time Sensitive - Container", headerFilter:"input"},
            {title:"Owner Name", field:"Owner Name - Container", headerFilter:"input"},
            {title:"Product Identifier", field:"Product Identifier - Product", headerFilter:"input"},
            {title:"Current Quantity", field:"Current Quantity - Container", headerFilter:"input"},
            {title:"Unit", field:"Unit - Container", headerFilter:"input"},
            {title:"NFPA 704 Health Hazard", field:"NFPA 704 Health Hazard - Product", headerFilter:"input"},
            {title:"NFPA 704 Flammability Hazard", field:"NFPA 704 Flammability Hazard - Product", headerFilter:"input"}
        ];

        // 'data' is passed from Flask via Jinja2.
        var campaignData = {{ data|tojson }};

        // Initialize Tabulator to display the campaign data.
        new Tabulator("#campaign-table", {
            layout:"fitColumns",
            pagination:"local",
            paginationSize:10,
            columns: columns,
            data: campaignData,
            initialSort:[{column:"timestamp", dir:"desc"}]
        });
    });
  </script>
{% endblock %}